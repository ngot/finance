<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>房地产投资计算器</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>房地产投资计算器</h1>
            <p class="subtitle">评估房地产投资的现金流、资本增值和税务影响</p>
        </header>

        <!-- Profile管理 -->
        <div class="profile-section">
            <h2>投资方案管理</h2>
            <div class="profile-controls">
                <div class="profile-selector">
                    <label for="profileSelect">当前方案:</label>
                    <select id="profileSelect">
                        <option value="default">默认方案</option>
                    </select>
                </div>
                <div class="profile-actions">
                    <button id="newProfileBtn" class="profile-btn">新建方案</button>
                    <button id="saveProfileBtn" class="profile-btn">保存方案</button>
                    <button id="deleteProfileBtn" class="profile-btn delete-btn">删除方案</button>
                    <button id="loadExampleBtn" class="profile-btn example-btn">加载示例</button>
                    <button id="exportBtn" class="profile-btn export-btn">导出数据</button>
                    <button id="importBtn" class="profile-btn import-btn">导入数据</button>
                </div>
                <input type="file" id="importFileInput" accept=".json" style="display: none;">
            </div>
        </div>

        <!-- 输入表单 -->
        <div class="input-section">
            <h2>投资信息输入</h2>
            
            <!-- 房产信息 -->
            <div class="form-group">
                <h3>房产信息</h3>
                <div class="input-row">
                    <label for="purchasePrice">购买价格 (AUD)</label>
                    <input type="number" id="purchasePrice" placeholder="例如: 800000">
                </div>
                <div class="input-row">
                    <label for="purchaseCosts">购买成本 (AUD)</label>
                    <input type="number" id="purchaseCosts" placeholder="例如: 40000">
                </div>
                <div class="input-row">
                    <label for="weeklyRent">每周租金 (AUD)</label>
                    <input type="number" id="weeklyRent" placeholder="例如: 600">
                </div>
                <div class="input-row">
                    <label for="rentalGrowthRate">年度租金增长率 (%)</label>
                    <input type="number" id="rentalGrowthRate" step="0.1" placeholder="例如: 3.0">
                </div>
                <div class="input-row">
                    <label for="propertyType">房产类型</label>
                    <select id="propertyType">
                        <option value="house">独立屋</option>
                        <option value="apartment">公寓</option>
                        <option value="townhouse">联排别墅</option>
                    </select>
                </div>
            </div>

            <!-- 贷款信息 -->
            <div class="form-group">
                <h3>贷款信息</h3>
                <div class="input-row">
                    <label for="loanAmount">贷款金额 (AUD)</label>
                    <input type="number" id="loanAmount" placeholder="例如: 640000">
                </div>
                <div class="input-row">
                    <label for="interestRate">年利率 (%)</label>
                    <input type="number" id="interestRate" step="0.01" placeholder="例如: 6.5">
                </div>
                <div class="input-row">
                    <label for="loanTerm">贷款期限 (年)</label>
                    <input type="number" id="loanTerm" placeholder="例如: 30">
                </div>
                <div class="input-row">
                    <label for="repaymentType">还款类型</label>
                    <select id="repaymentType">
                        <option value="principal_interest">本息同还</option>
                        <option value="interest_only">只付利息</option>
                    </select>
                </div>
            </div>

            <!-- 运营费用 -->
            <div class="form-group">
                <h3>年度运营费用</h3>
                <div class="input-row">
                    <label for="strataFees">物业管理费 (AUD)</label>
                    <input type="number" id="strataFees" placeholder="例如: 3000">
                </div>
                <div class="input-row">
                    <label for="councilRates">市政费 (AUD)</label>
                    <input type="number" id="councilRates" placeholder="例如: 2000">
                </div>
                <div class="input-row">
                    <label for="waterRates">水费 (AUD)</label>
                    <input type="number" id="waterRates" placeholder="例如: 800">
                </div>
                <div class="input-row">
                    <label for="insurance">保险费 (AUD)</label>
                    <input type="number" id="insurance" placeholder="例如: 1200">
                </div>
                <div class="input-row">
                    <label for="maintenance">维护维修费 (AUD)</label>
                    <input type="number" id="maintenance" placeholder="例如: 2000">
                </div>
                <div class="input-row">
                    <label for="managementFees">中介管理费 (%)</label>
                    <input type="number" id="managementFees" step="0.1" placeholder="例如: 7.0">
                </div>
            </div>

            <!-- 个人税务信息 -->
            <div class="form-group">
                <h3>个人税务信息</h3>
                <div class="input-row">
                    <label for="personalIncome">年收入 (AUD)</label>
                    <input type="number" id="personalIncome" placeholder="例如: 120000">
                </div>
                <div class="input-row">
                    <label for="otherDeductions">其他税务抵扣 (AUD)</label>
                    <input type="number" id="otherDeductions" placeholder="例如: 5000">
                </div>
            </div>

            <!-- 投资假设 -->
            <div class="form-group">
                <h3>投资假设</h3>
                <div class="input-row">
                    <label for="capitalGrowthRate">年度资本增值率 (%)</label>
                    <input type="number" id="capitalGrowthRate" step="0.1" placeholder="例如: 5.0">
                </div>
                <div class="input-row">
                    <label for="holdingPeriod">持有年限</label>
                    <input type="number" id="holdingPeriod" placeholder="例如: 10">
                </div>
            </div>

            <button id="calculateBtn" class="calculate-btn">计算投资回报</button>
        </div>

        <!-- 结果显示区域 -->
        <div class="results-section" id="resultsSection" style="display: none;">
            <h2>投资分析报告</h2>
            
            <!-- 概览 -->
            <div class="result-group">
                <h3>投资概览</h3>
                <div class="overview-grid">
                    <div class="overview-item clickable-item" onclick="openInitialInvestmentModal()">
                        <div class="item-content">
                            <span class="label">初始投资总额</span>
                            <span class="value" id="totalInitialInvestment">-</span>
                        </div>
                        <span class="detail-icon">🔍</span>
                    </div>
                    <div class="overview-item">
                        <span class="label">预计持有年限</span>
                        <span class="value" id="displayHoldingPeriod">-</span>
                    </div>
                    <div class="overview-item">
                        <span class="label">预计出售时房产价值</span>
                        <span class="value" id="futurePropertyValue">-</span>
                    </div>
                    <div class="overview-item">
                        <span class="label">毛租金收益率</span>
                        <span class="value" id="grossRentalYield">-</span>
                    </div>
                    <div class="overview-item">
                        <span class="label">净租金收益率</span>
                        <span class="value" id="netRentalYield">-</span>
                    </div>
                </div>
            </div>

            <!-- 投资回报分析 -->
            <div class="result-group">
                <h3>投资回报分析</h3>
                <div class="return-grid">
                    <div class="return-item clickable-item" onclick="openCapitalGrowthModal()">
                        <div class="item-content">
                            <span class="label">总资本增值</span>
                            <span class="value" id="totalCapitalGrowth">-</span>
                        </div>
                        <span class="detail-icon">🔍</span>
                    </div>
                    <div class="return-item clickable-item" onclick="openRentalIncomeModal()">
                        <div class="item-content">
                            <span class="label">累计租金收入</span>
                            <span class="value" id="totalRentalIncome">-</span>
                        </div>
                        <span class="detail-icon">🔍</span>
                    </div>
                    <div class="return-item tax-benefits-item">
                        <div class="tax-benefits-header" onclick="openTaxBenefitsModal()">
                            <div class="tax-benefits-main">
                                <span class="label">累计税务优惠</span>
                                <span class="value" id="totalTaxBenefits">-</span>
                            </div>
                            <span class="detail-icon">🔍</span>
                        </div>
                    </div>
                    <div class="return-item clickable-item" onclick="openAfterTaxReturnModal()">
                        <div class="item-content">
                            <span class="label">税后总回报</span>
                            <span class="value" id="totalAfterTaxReturn">-</span>
                        </div>
                        <span class="detail-icon">🔍</span>
                    </div>
                    <div class="return-item clickable-item" onclick="openIrrModal()">
                        <div class="item-content">
                            <span class="label">年化回报率 (IRR)</span>
                            <span class="value" id="irr">-</span>
                        </div>
                        <span class="detail-icon">🔍</span>
                    </div>
                </div>
            </div>

            <!-- 税务总结 -->
            <div class="result-group">
                <h3>税务总结</h3>
                <div class="tax-summary">
                    <div class="tax-item clickable-item" onclick="openTotalDeductionsModal()">
                        <div class="item-content">
                            <span class="label">累计可抵扣费用</span>
                            <span class="value" id="totalDeductions">-</span>
                        </div>
                        <span class="detail-icon">🔍</span>
                    </div>
                    <div class="tax-item clickable-item" onclick="openCgtModal()">
                        <div class="item-content">
                            <span class="label">预计资本利得税 (CGT)</span>
                            <span class="value" id="capitalGainsTax">-</span>
                        </div>
                        <span class="detail-icon">🔍</span>
                    </div>
                    <div class="tax-item">
                        <span class="label">CGT折扣适用</span>
                        <span class="value" id="cgtDiscountApplicable">-</span>
                    </div>
                </div>
            </div>

            <!-- 出售时机建议 -->
            <div class="result-group">
                <h3>出售时机建议</h3>
                <div id="sellingRecommendation" class="recommendation">
                    <!-- 动态生成建议内容 -->
                </div>
            </div>

            <!-- 现金流图表 - 移到最下面 -->
            <div class="result-group chart-section">
                <h3>年度现金流分析图表</h3>
                <div class="chart-container">
                    <canvas id="cashFlowChart"></canvas>
                </div>
            </div>
        </div>

        <!-- 税务优惠详情弹窗 -->
        <div id="taxBenefitsModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>税务优惠详细分析</h3>
                    <span class="close-btn" onclick="closeTaxBenefitsModal()">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="modal-summary">
                        <div class="summary-card">
                            <h4>累计税务优惠总额</h4>
                            <div class="summary-amount" id="modalTotalBenefits">-</div>
                            <div class="summary-details">
                                <span>受益年数: <strong id="modalBenefitYears">-</strong></span>
                                <span>边际税率: <strong id="modalTaxRate">-</strong></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-tabs">
                        <button class="tab-btn active" onclick="switchTab('yearly')">年度明细</button>
                        <button class="tab-btn" onclick="switchTab('breakdown')">抵扣分解</button>
                        <button class="tab-btn" onclick="switchTab('explanation')">税务说明</button>
                    </div>
                    
                    <div class="tab-content">
                        <!-- 年度明细标签页 -->
                        <div id="yearlyTab" class="tab-pane active">
                            <div id="yearlyDetailContent">
                                <!-- 动态生成年度明细 -->
                            </div>
                        </div>
                        
                        <!-- 抵扣分解标签页 -->
                        <div id="breakdownTab" class="tab-pane">
                            <div id="breakdownDetailContent">
                                <!-- 动态生成抵扣分解 -->
                            </div>
                        </div>
                        
                        <!-- 税务说明标签页 -->
                        <div id="explanationTab" class="tab-pane">
                            <div class="tax-explanation-detailed">
                                <h5>澳大利亚房产投资税务机制</h5>
                                
                                <div class="explanation-section">
                                    <h6>1. 负扣税 (Negative Gearing)</h6>
                                    <p>当房产投资的可抵扣费用超过租金收入时，产生的亏损可以抵扣投资者的其他应税收入，从而减少总体税款。</p>
                                    <ul>
                                        <li>适用于所有类型的投资房产</li>
                                        <li>亏损金额按投资者的边际税率计算税务优惠</li>
                                        <li>可以跨年度结转未使用的亏损</li>
                                    </ul>
                                </div>
                                
                                <div class="explanation-section">
                                    <h6>2. 主要可抵扣费用</h6>
                                    <ul>
                                        <li><strong>贷款利息：</strong>投资房贷款的利息部分</li>
                                        <li><strong>物业管理费：</strong>公寓的strata fees等</li>
                                        <li><strong>市政费用：</strong>council rates, water rates等</li>
                                        <li><strong>保险费用：</strong>房东保险premiums</li>
                                        <li><strong>维护费用：</strong>修理和维护成本</li>
                                        <li><strong>中介费用：</strong>租赁管理费用</li>
                                        <li><strong>折旧费用：</strong>建筑和设备折旧</li>
                                    </ul>
                                </div>
                                
                                <div class="explanation-section">
                                    <h6>3. 折旧计算</h6>
                                    <ul>
                                        <li><strong>Division 43：</strong>建筑结构折旧，新建筑2.5%/年，40年</li>
                                        <li><strong>Division 40：</strong>设备折旧，如空调、地毯等</li>
                                        <li>只有1987年后建造的房产可以申请建筑折旧</li>
                                    </ul>
                                </div>
                                
                                <div class="explanation-section">
                                    <h6>4. 税率影响</h6>
                                    <p>税务优惠金额 = 亏损金额 × 边际税率</p>
                                    <div class="tax-brackets">
                                        <div class="bracket">$0 - $18,200: 0%</div>
                                        <div class="bracket">$18,201 - $45,000: 19%</div>
                                        <div class="bracket">$45,001 - $120,000: 32.5%</div>
                                        <div class="bracket">$120,001 - $180,000: 37%</div>
                                        <div class="bracket">$180,001+: 45%</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 通用详情弹窗 -->
        <div id="detailModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTitle">详细信息</h3>
                    <span class="close-btn" onclick="closeDetailModal()">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="modal-summary">
                        <div class="summary-card">
                            <h4 id="modalSummaryTitle">-</h4>
                            <div class="summary-amount" id="modalSummaryAmount">-</div>
                            <div class="summary-details" id="modalSummaryDetails">
                                <!-- 动态生成摘要详情 -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-tabs" id="modalTabs">
                        <!-- 动态生成标签页 -->
                    </div>
                    
                    <div class="tab-content" id="modalTabContent">
                        <!-- 动态生成标签页内容 -->
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <div class="disclaimer">
                <h4>免责声明</h4>
                <p>本计算器提供的所有计算均基于用户输入的假设和预测，仅供参考。实际结果可能因市场波动、政策变化等因素而有所不同。本工具不构成专业的税务或投资建议，用户在做出任何投资决策前应咨询合格的专业顾问。</p>
            </div>
        </footer>
    </div>

    <script src="calculator.js"></script>
</body>
</html>